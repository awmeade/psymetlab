sec.2.vars <- grep(sec2.vars.basename[i], names(d), value=TRUE)
l.d.sec.2[[i]] <- d[sec.2.vars]
}
l.d.sec.2
l.d.sec.2[1]
describe(l.d.sec.2[1])
describe(l.d.sec.2[[1]])
describe(l.d.sec.2[[5]])
f.section.2.corrs <- local(function(perf.var,d,...){
RRPT.vars <- grep("RRPT", names(d), value=TRUE)
RRPT.data <- d[RRPT.vars]
pers.data <- d[748:775]
vars.current.perf <- grep(perf.var, names(d), value=TRUE)
perf.data <- d[vars.current.perf]
out <- corr.test(pers.data,perf.data,adjust="none")
f.write.corrs(f.name = 'section 2.xlsx', s.name = paste0('Big5_',perf.var), obj.corrs = out, print.p = FALSE, print.n = FALSE, is.triangle=FALSE)
out <- corr.test(RRPT.data,perf.data,adjust="none")
f.write.corrs(f.name = 'section 2.xlsx',s.name = paste0('RRPT_',perf.var), obj.corrs = out, print.p = FALSE, print.n = FALSE,is.triangle=FALSE)
return(TRUE)
})
i=1
lapply(l.d.sec.2[[i]],FUN = f.section.2.corrs, d=d) # apply to all in this array
l.d.sec.2[[i]]
lapply(names(l.d.sec.2[[i]]),FUN = f.section.2.corrs, d=d) # apply to all in this array
rm(list = ls())
library("psych")
library('devtools')
remove.packages('psymetlab') # refresh psymetlab
install_github('awmeade/psymetlab')
library('psymetlab')
library('xlsx')
d.0 <- read.csv("CCL_merged.csv")  ## read data
file.remove('output.xlsx')
RRPT.vars <- grep("RRPT", names(d.0), value=TRUE)
d <- f.screen.outliers(d.0,RRPT.vars)
rm(d.0)
d.RRPT <- d[RRPT.vars]
d.pers <- d[748:775]
big5.vars <- c("N_Need","E_Extrav","O_Origin","A_Accomd","C_Consol")
d.big5.only <- d[big5.vars]
facet.vars <- names(d.pers) %in% big5.vars
d.facet.only <- d.pers[!facet.vars]
sec3.vars <- grep("S3_", names(d), value=TRUE)
d.section.3 <- d[sec3.vars]
# section 2 stuff
sec2.vars.basename <- names(d[146:165])
l.d.sec.2 <- list()
for(i in 1:length(sec2.vars.basename)){
sec.2.vars <- grep(sec2.vars.basename[i], names(d), value=TRUE)
l.d.sec.2[[i]] <- d[sec.2.vars]
}
describe(l.d.sec.2[[5]])
rm(facet.vars)
f.section.2.corrs <- local(function(perf.var,d,...){
RRPT.vars <- grep("RRPT", names(d), value=TRUE)
RRPT.data <- d[RRPT.vars]
pers.data <- d[748:775]
vars.current.perf <- grep(perf.var, names(d), value=TRUE)
perf.data <- d[vars.current.perf]
out <- corr.test(pers.data,perf.data,adjust="none")
f.write.corrs(f.name = 'section 2.xlsx', s.name = paste0('Big5_',perf.var), obj.corrs = out, print.p = FALSE, print.n = FALSE, is.triangle=FALSE)
out <- corr.test(RRPT.data,perf.data,adjust="none")
f.write.corrs(f.name = 'section 2.xlsx',s.name = paste0('RRPT_',perf.var), obj.corrs = out, print.p = FALSE, print.n = FALSE,is.triangle=FALSE)
return(TRUE)
})
i=1
lapply(names(l.d.sec.2[[i]]),FUN = f.section.2.corrs, d=d) # apply to all in this array
names(l.d.sec.2[[i]])
rm(list = ls())
d.0 <- read.csv("CCL_merged.csv")  ## read data
RRPT.vars <- grep("RRPT", names(d.0), value=TRUE)
d <- f.screen.outliers(d.0,RRPT.vars)
rm(d.0)
d.RRPT <- d[RRPT.vars]
d.pers <- d[748:775]
big5.vars <- c("N_Need","E_Extrav","O_Origin","A_Accomd","C_Consol")
d.big5.only <- d[big5.vars]
facet.vars <- names(d.pers) %in% big5.vars
d.facet.only <- d.pers[!facet.vars]
sec3.vars <- grep("S3_", names(d), value=TRUE)
d.section.3 <- d[sec3.vars]
# section 2 stuff
sec2.vars.basename <- names(d[146:165])
lapply(sec2.vars.basename,FUN = f.section.2.corrs, d=d) # apply to all in this array
f.section.2.corrs <- local(function(perf.var,d,...){
RRPT.vars <- grep("RRPT", names(d), value=TRUE)
RRPT.data <- d[RRPT.vars]
pers.data <- d[748:775]
vars.current.perf <- grep(perf.var, names(d), value=TRUE)
perf.data <- d[vars.current.perf]
out <- corr.test(pers.data,perf.data,adjust="none")
f.write.corrs(f.name = 'section 2.xlsx', s.name = paste0('Big5_',perf.var), obj.corrs = out, print.p = FALSE, print.n = FALSE, is.triangle=FALSE)
out <- corr.test(RRPT.data,perf.data,adjust="none")
f.write.corrs(f.name = 'section 2.xlsx',s.name = paste0('RRPT_',perf.var), obj.corrs = out, print.p = FALSE, print.n = FALSE,is.triangle=FALSE)
return(TRUE)
})
lapply(sec2.vars.basename,FUN = f.section.2.corrs, d=d) # apply to all in this array
f.section.3.corrs <- local(function(d,perf.var,...){
RRPT.vars <- grep("RRPT", names(d), value=TRUE)
RRPT.data <- d[RRPT.vars]
pers.data <- d[748:775]
vars.current.perf <- grep(perf.var, names(d), value=TRUE)
perf.data <- d[vars.current.perf]
out <- corr.test(pers.data,perf.data,adjust="none")
f.write.corrs(f.name, s.name = paste0('Big5_',perf.var), obj.corrs = out, print.p = FALSE, print.n = FALSE, is.triangle=FALSE)
out <- corr.test(RRPT.data,perf.data,adjust="none")
f.write.corrs(f.name,s.name = paste0('RRPT_',perf.var), obj.corrs = out, print.p = FALSE, print.n = FALSE,is.triangle=FALSE)
return(TRUE)
})
lapply(sec2.vars.basename,FUN = f.section.2and3.corrs, d=d, f.name="section2corrs.xlsx") # apply to all in this array
f.section.2and3.corrs <- local(function(d,perf.var,...){
RRPT.vars <- grep("RRPT", names(d), value=TRUE)
RRPT.data <- d[RRPT.vars]
pers.data <- d[748:775]
vars.current.perf <- grep(perf.var, names(d), value=TRUE)
perf.data <- d[vars.current.perf]
out <- corr.test(pers.data,perf.data,adjust="none")
f.write.corrs(f.name, s.name = paste0('Big5_',perf.var), obj.corrs = out, print.p = FALSE, print.n = FALSE, is.triangle=FALSE)
out <- corr.test(RRPT.data,perf.data,adjust="none")
f.write.corrs(f.name,s.name = paste0('RRPT_',perf.var), obj.corrs = out, print.p = FALSE, print.n = FALSE,is.triangle=FALSE)
return(TRUE)
})
lapply(sec2.vars.basename,FUN = f.section.2and3.corrs, d=d, f.name="section2corrs.xlsx") # apply to all in this array
lapply(sec2.vars.basename,FUN = f.section.2and3.corrs, d=d, f.name="section2corrs.xlsx") # apply to all in this array
sec2.vars <- names(d[146:165])
?f.write.corrs
?f.write.corrs
?f.write.corrs
?f.write.corrs
?f.write.corrs
remove.packages('psymetlab') # refresh psymetlab
install_github('awmeade/psymetlab')
library('psymetlab')
lapply(sec2.vars.basename,FUN = f.section.2and3.corrs, d=d, f.name="section2corrs.xlsx") # apply to all in this array
lapply(sec2.vars.basename,FUN = f.section.2and3.corrs, d=d, f.name="section2corrs.xlsx") # apply to all in this array
?file.exists
lapply(sec2.vars.basename,FUN = f.section.2and3.corrs, d=d, f.name="section2corrs.xlsx") # apply to all in this array
rm(f.section.2.corrs())
rm(f.section.2.corrs)
rm(f.section.3.corrs)
lapply(sec2.vars.basename,FUN = f.section.2and3.corrs, d=d, f.name="section2corrs.xlsx") # apply to all in this array
f.section.2and3.corrs <- local(function(d, perf.var, f.name){
RRPT.vars <- grep("RRPT", names(d), value=TRUE)
RRPT.data <- d[RRPT.vars]
pers.data <- d[748:775]
vars.current.perf <- grep(perf.var, names(d), value=TRUE)
perf.data <- d[vars.current.perf]
out <- corr.test(pers.data,perf.data,adjust="none")
f.write.corrs(f.name, s.name = paste0('Big5_',perf.var), obj.corrs = out, print.p = FALSE, print.n = FALSE, is.triangle=FALSE)
out <- corr.test(RRPT.data,perf.data,adjust="none")
f.write.corrs(f.name,s.name = paste0('RRPT_',perf.var), obj.corrs = out, print.p = FALSE, print.n = FALSE,is.triangle=FALSE)
return(TRUE)
})
lapply(sec2.vars.basename,FUN = f.section.2and3.corrs, d=d, f.name="section2corrs.xlsx") # apply to all in this array
rm(i)
sec3.vars
sec2.vars.temp <- C()
sec2.vars.temp <- c(sec2.vars.temp,grep(sec2.vars[i], names(d), value=TRUE))
for(i in 1:length(sec2.vars)){
sec2.vars.temp <- c(sec2.vars.temp,grep(sec2.vars[i], names(d), value=TRUE))
}
sec2.vars.temp <- C()
sec2.vars.temp <- character()
for(i in 1:length(sec2.vars)){
sec2.vars.temp <- c(sec2.vars.temp,grep(sec2.vars[i], names(d), value=TRUE))
}
sec2.vars.temp
d.section.2 <- d[sec2.vars.temp]
rm(facet.vars, sec2.vars.temp)
rm.sec2.vars.basename
rm.sec2.vars.basename
rm(sec2.vars.basename)
rm(list = ls())
library("psych")
library('devtools')
library('psymetlab')
library('xlsx')
d.0 <- read.csv("CCL_merged.csv")  ## read data
RRPT.vars <- grep("RRPT", names(d.0), value=TRUE)
d <- f.screen.outliers(d.0,RRPT.vars)
rm(d.0)
d.RRPT <- d[RRPT.vars]
d.pers <- d[748:775]
big5.vars <- c("N_Need","E_Extrav","O_Origin","A_Accomd","C_Consol")
d.big5.only <- d[big5.vars]
facet.vars <- names(d.pers) %in% big5.vars
d.facet.only <- d.pers[!facet.vars]
sec3.vars <- grep("S3_", names(d), value=TRUE)
d.section.3 <- d[sec3.vars]
# section 2 stuff
sec2.vars <- names(d[146:165])
sec2.vars.temp <- character()
for(i in 1:length(sec2.vars)){
sec2.vars.temp <- c(sec2.vars.temp,grep(sec2.vars[i], names(d), value=TRUE))
}
d.section.2 <- d[sec2.vars.temp]
rm(facet.vars, sec2.vars.temp)
rm(facet.vars, sec2.vars.temp, i)
f.section.2and3.corrs <- local(function(d, perf.var, f.name){
RRPT.vars <- grep("RRPT", names(d), value=TRUE)
RRPT.data <- d[RRPT.vars]
pers.data <- d[748:775]
vars.current.perf <- grep(perf.var, names(d), value=TRUE)
perf.data <- d[vars.current.perf]
out <- corr.test(pers.data,perf.data,adjust="none")
f.write.corrs(f.name, s.name = paste0('Big5_',perf.var), obj.corrs = out, print.p = FALSE, print.n = FALSE, is.triangle=FALSE)
out <- corr.test(RRPT.data,perf.data,adjust="none")
f.write.corrs(f.name,s.name = paste0('RRPT_',perf.var), obj.corrs = out, print.p = FALSE, print.n = FALSE,is.triangle=FALSE)
return(TRUE)
})
s03.vars <- "S3_01"
for(i in 2:9){
s03.vars <- c(s03.vars,paste0("S3_0",i))
}
s03.vars <- c(s03.vars,"S3_10") #manually add these two.  Inelegant!
s03.vars <- c(s03.vars,"S3_11")
s03.vars
lapply(s03.vars,FUN = f.section.2and3.corrs, d=d, f.name="section 3 corrs.xlsx") # apply to all in this array
rm(i)
f.do.reg <- local(function(d.crit,d.pred){
r.ls <- list()
for(r in 1:ncol(d.crit)){
crit.var.name <- colnames(d.crit)[r]
f.p1 <- paste0(crit.var.name, ' ~ ')
f.nameme <- as.formula(paste(f.p1, paste(colnames(d.pred), collapse='+')))
d.reg <- cbind(d.pred,d.crit[crit.var.name])
reg <- lm(f.nameme, d.reg)
r.ls[[r]] <- f.get.reg.output(reg)
names(r.ls)[[r]]<-crit.var.name
}
return(r.ls)
})
RRPT.reg.out <- f.do.reg(d.crit = d.section.2, d.pred = d.RRPT)
write.xlsx(RRPT.reg.out, file="Section 2 reg.xlsx", sheetName="RRPT", row.names=TRUE, append=TRUE, showNA=FALSE)
#### Big 5
big5.reg.out <- f.do.reg(d.crit = d.section.2, d.pred = d.big5.only)
write.xlsx(big5.reg.out, file="Section 2 reg.xlsx", sheetName="big5", row.names=TRUE, append=TRUE, showNA=FALSE)
#### facets
facets.reg.out <- f.do.reg(d.crit = d.section.2, d.pred = d.facet.only)
write.xlsx(facets.reg.out, file="Section 2 reg.xlsx", sheetName="facets", row.names=TRUE, append=TRUE, showNA=FALSE)
df.rsq <- data.frame(matrix(ncol = 3, nrow = length(RRPT.reg.out)))
for(l in 1:length(RRPT.reg.out)){
crit.var <- names(RRPT.reg.out)[l]
df.rsq[l,1] <- RRPT.reg.out[[l]][nrow(RRPT.reg.out[[l]])-1,1] #get element in column 1, row before last
df.rsq[l,2] <- big5.reg.out[[l]][nrow(big5.reg.out[[l]])-1,1] #get element in column 1, row before last
df.rsq[l,3] <- facets.reg.out[[l]][nrow(facets.reg.out[[l]])-1,1]
}
rownames(df.rsq) <- names(RRPT.reg.out)
colnames(df.rsq) <- c("RRPT","Big5","Facets")
write.xlsx(df.rsq, file="Section 2 reg.xlsx", sheetName="Rsq values",append=TRUE)
rm(l,big5.reg.out,facets.reg.out,RRPT.reg.out)
df.rsq <- data.frame(matrix(ncol = 3, nrow = length(RRPT.reg.out)))
df.pvals <- data.frame(matrix(ncol = 3, nrow = length(RRPT.reg.out)))
RRPT.reg.out <- f.do.reg(d.crit = d.section.2, d.pred = d.RRPT)
big5.reg.out <- f.do.reg(d.crit = d.section.2, d.pred = d.big5.only)
write.xlsx(RRPT.reg.out, file="Section 2 reg.xlsx", sheetName="RRPT", row.names=TRUE, append=TRUE, showNA=FALSE)
write.xlsx(big5.reg.out, file="Section 2 reg.xlsx", sheetName="big5", row.names=TRUE, append=TRUE, showNA=FALSE)
facets.reg.out <- f.do.reg(d.crit = d.section.2, d.pred = d.facet.only)
write.xlsx(facets.reg.out, file="Section 2 reg.xlsx", sheetName="facets", row.names=TRUE, append=TRUE, showNA=FALSE)
df.rsq <- data.frame(matrix(ncol = 3, nrow = length(RRPT.reg.out)))
df.pvals <- data.frame(matrix(ncol = 3, nrow = length(RRPT.reg.out)))
for(l in 1:length(RRPT.reg.out)){
crit.var <- names(RRPT.reg.out)[l]
df.rsq[l,1] <- RRPT.reg.out[[l]][nrow(RRPT.reg.out[[l]])-1,1] #get element in column 1, row before last
df.pvals[l,1] <- RRPT.reg.out[[l]][nrow(RRPT.reg.out[[l]])-2,1] #get element in column 1, two rows before last
df.rsq[l,2] <- big5.reg.out[[l]][nrow(big5.reg.out[[l]])-1,1] #get element in column 1, row before last
df.pvals[l,2] <- big5.reg.out[[l]][nrow(big5.reg.out[[l]])-2,1] #get element in column 1, row before last
df.rsq[l,3] <- facets.reg.out[[l]][nrow(facets.reg.out[[l]])-1,1]
df.pvals[l,3] <- facets.reg.out[[l]][nrow(facets.reg.out[[l]])-2,1]
}
rownames(df.rsq) <- rownames(df.pval) <- names(RRPT.reg.out)
rownames(df.rsq) <- rownames(df.pvals) <- names(RRPT.reg.out)
colnames(df.rsq) <- colnames(df.pvals) <- c("RRPT","Big5","Facets")
write.xlsx(df.rsq, file="Section 2 reg.xlsx", sheetName="Rsq values",append=TRUE)
write.xlsx(df.pvals, file="Section 2 reg.xlsx", sheetName="model p values",append=TRUE)
rm(l,big5.reg.out,facets.reg.out,RRPT.reg.out,df.pvals)
RRPT.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.RRPT)
write.xlsx(RRPT.reg.out, file="regressions.xlsx", sheetName="RRPT", row.names=TRUE, append=TRUE, showNA=FALSE)
#### Big 5
big5.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.big5.only)
write.xlsx(big5.reg.out, file="regressions.xlsx", sheetName="big5", row.names=TRUE, append=TRUE, showNA=FALSE)
#### facets
facets.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.facet.only)
write.xlsx(facets.reg.out, file="regressions.xlsx", sheetName="facets", row.names=TRUE, append=TRUE, showNA=FALSE)
df.rsq <- data.frame(matrix(ncol = 3, nrow = length(RRPT.reg.out)))
df.pvals <- data.frame(matrix(ncol = 3, nrow = length(RRPT.reg.out)))
for(l in 1:length(RRPT.reg.out)){
crit.var <- names(RRPT.reg.out)[l]
df.rsq[l,1] <- RRPT.reg.out[[l]][nrow(RRPT.reg.out[[l]])-1,1] #get element in column 1, row before last
df.pvals[l,1] <- RRPT.reg.out[[l]][nrow(RRPT.reg.out[[l]])-2,1] #get element in column 1, two rows before last
df.rsq[l,2] <- big5.reg.out[[l]][nrow(big5.reg.out[[l]])-1,1] #get element in column 1, row before last
df.pvals[l,2] <- big5.reg.out[[l]][nrow(big5.reg.out[[l]])-2,1] #get element in column 1, row before last
df.rsq[l,3] <- facets.reg.out[[l]][nrow(facets.reg.out[[l]])-1,1]
df.pvals[l,3] <- facets.reg.out[[l]][nrow(facets.reg.out[[l]])-2,1]
}
rownames(df.rsq) <- rownames(df.pvals) <- names(RRPT.reg.out)
colnames(df.rsq) <- colnames(df.pvals) <- c("RRPT","Big5","Facets")
write.xlsx(df.rsq, file="Section 3 reg.xlsx", sheetName="Rsq values",append=TRUE)
write.xlsx(df.pvals, file="Section 3 reg.xlsx", sheetName="model p values",append=TRUE)
rm(l,big5.reg.out,facets.reg.out,RRPT.reg.out,df.pvals)
file.remove('regressions.xlsx')
RRPT.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.RRPT)
write.xlsx(RRPT.reg.out, file="Section 3 reg.xlsx", sheetName="RRPT", row.names=TRUE, append=TRUE, showNA=FALSE)
big5.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.big5.only)
write.xlsx(big5.reg.out, file="Section 3 reg.xlsx", sheetName="big5", row.names=TRUE, append=TRUE, showNA=FALSE)
#### facets
facets.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.facet.only)
write.xlsx(facets.reg.out, file="Section 3 reg.xlsx", sheetName="facets", row.names=TRUE, append=TRUE, showNA=FALSE)
df.rsq <- data.frame(matrix(ncol = 3, nrow = length(RRPT.reg.out)))
df.pvals <- data.frame(matrix(ncol = 3, nrow = length(RRPT.reg.out)))
for(l in 1:length(RRPT.reg.out)){
crit.var <- names(RRPT.reg.out)[l]
df.rsq[l,1] <- RRPT.reg.out[[l]][nrow(RRPT.reg.out[[l]])-1,1] #get element in column 1, row before last
df.pvals[l,1] <- RRPT.reg.out[[l]][nrow(RRPT.reg.out[[l]])-2,1] #get element in column 1, two rows before last
df.rsq[l,2] <- big5.reg.out[[l]][nrow(big5.reg.out[[l]])-1,1] #get element in column 1, row before last
df.pvals[l,2] <- big5.reg.out[[l]][nrow(big5.reg.out[[l]])-2,1] #get element in column 1, row before last
df.rsq[l,3] <- facets.reg.out[[l]][nrow(facets.reg.out[[l]])-1,1]
df.pvals[l,3] <- facets.reg.out[[l]][nrow(facets.reg.out[[l]])-2,1]
}
rownames(df.rsq) <- rownames(df.pvals) <- names(RRPT.reg.out)
colnames(df.rsq) <- colnames(df.pvals) <- c("RRPT","Big5","Facets")
write.xlsx(df.rsq, file="Section 3 reg.xlsx", sheetName="Rsq values",append=TRUE)
write.xlsx(df.pvals, file="Section 3 reg.xlsx", sheetName="model p values",append=TRUE)
RRPT.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.RRPT)
write.xlsx(RRPT.reg.out, file="Section 3 reg.xlsx", sheetName="RRPT", row.names=TRUE, append=TRUE, showNA=FALSE)
#### Big 5
big5.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.big5.only)
write.xlsx(big5.reg.out, file="Section 3 reg.xlsx", sheetName="big5", row.names=TRUE, append=TRUE, showNA=FALSE)
#### facets
facets.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.facet.only)
write.xlsx(facets.reg.out, file="Section 3 reg.xlsx", sheetName="facets", row.names=TRUE, append=TRUE, showNA=FALSE)
df.rsq <- data.frame(matrix(ncol = 3, nrow = length(RRPT.reg.out)))
df.pvals <- data.frame(matrix(ncol = 3, nrow = length(RRPT.reg.out)))
for(l in 1:length(RRPT.reg.out)){
crit.var <- names(RRPT.reg.out)[l]
df.rsq[l,1] <- RRPT.reg.out[[l]][nrow(RRPT.reg.out[[l]])-1,1] #get element in column 1, row before last
df.pvals[l,1] <- RRPT.reg.out[[l]][nrow(RRPT.reg.out[[l]])-2,1] #get element in column 1, two rows before last
df.rsq[l,2] <- big5.reg.out[[l]][nrow(big5.reg.out[[l]])-1,1] #get element in column 1, row before last
df.pvals[l,2] <- big5.reg.out[[l]][nrow(big5.reg.out[[l]])-2,1] #get element in column 1, row before last
df.rsq[l,3] <- facets.reg.out[[l]][nrow(facets.reg.out[[l]])-1,1]
df.pvals[l,3] <- facets.reg.out[[l]][nrow(facets.reg.out[[l]])-2,1]
}
rownames(df.rsq) <- rownames(df.pvals) <- names(RRPT.reg.out)
colnames(df.rsq) <- colnames(df.pvals) <- c("RRPT","Big5","Facets")
write.xlsx(df.rsq, file="Section 3 reg.xlsx", sheetName="Rsq values",append=TRUE)
write.xlsx(df.pvals, file="Section 3 reg.xlsx", sheetName="model p values",append=TRUE)
rm(l,big5.reg.out,facets.reg.out,RRPT.reg.out,df.pvals)
rm(list = ls())
library("psych")
library('devtools')
library('psymetlab')
library('xlsx')
d.0 <- read.csv("CCL_merged.csv")  ## read data
file.remove('output.xlsx')
RRPT.vars <- grep("RRPT", names(d.0), value=TRUE)
d <- f.screen.outliers(d.0,RRPT.vars)
rm(d.0)
d.RRPT <- d[RRPT.vars]
d.pers <- d[748:775]
big5.vars <- c("N_Need","E_Extrav","O_Origin","A_Accomd","C_Consol")
d.big5.only <- d[big5.vars]
facet.vars <- names(d.pers) %in% big5.vars
d.facet.only <- d.pers[!facet.vars]
sec3.vars <- grep("S3_", names(d), value=TRUE)
d.section.3 <- d[sec3.vars]
# section 2 stuff
sec2.vars <- names(d[146:165])
sec2.vars.temp <- character()
for(i in 1:length(sec2.vars)){
sec2.vars.temp <- c(sec2.vars.temp,grep(sec2.vars[i], names(d), value=TRUE))
}
d.section.2 <- d[sec2.vars.temp]
rm(facet.vars, sec2.vars.temp, i)
f.do.reg <- local(function(d.crit,d.pred){
r.ls <- list()
for(r in 1:ncol(d.crit)){
crit.var.name <- colnames(d.crit)[r]
f.p1 <- paste0(crit.var.name, ' ~ ')
f.nameme <- as.formula(paste(f.p1, paste(colnames(d.pred), collapse='+')))
d.reg <- cbind(d.pred,d.crit[crit.var.name])
reg <- lm(f.nameme, d.reg)
r.ls[[r]] <- f.get.reg.output(reg)
names(r.ls)[[r]]<-crit.var.name
}
return(r.ls)
})
file.remove('regressions.xlsx')
RRPT.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.RRPT)
write.xlsx(RRPT.reg.out, file="Section 3 reg.xlsx", sheetName="RRPT", row.names=TRUE, append=TRUE, showNA=FALSE)
big5.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.big5.only)
write.xlsx(big5.reg.out, file="Section 3 reg.xlsx", sheetName="big5", row.names=TRUE, append=TRUE, showNA=FALSE)
facets.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.facet.only)
write.xlsx(facets.reg.out, file="Section 3 reg.xlsx", sheetName="facets", row.names=TRUE, append=TRUE, showNA=FALSE)
f.get.rsq.and.p <- function(out1,out2,out3){
df.rsq <- data.frame(matrix(ncol = 3, nrow = length(out1)))
df.pvals <- data.frame(matrix(ncol = 3, nrow = length(out1)))
for(l in 1:length(out1)){
crit.var <- names(out1)[l]
df.rsq[l,1] <- out1[[l]][nrow(out1[[l]])-1,1] #get element in column 1, row before last
df.pvals[l,1] <- out1[[l]][nrow(out1[[l]])-2,1] #get element in column 1, two rows before last
df.rsq[l,2] <- out2[[l]][nrow(out2[[l]])-1,1] #get element in column 1, row before last
df.pvals[l,2] <- out2[[l]][nrow(out2[[l]])-2,1] #get element in column 1, row before last
df.rsq[l,3] <- out3[[l]][nrow(out3[[l]])-1,1]
df.pvals[l,3] <- out3[[l]][nrow(out3[[l]])-2,1]
}
r.df <- cbind(df.rsq,df.pvals)
rownames(r.df) <- names(out1)
colnames(r.df) <- c("RRPT.rsq","Big5.rsq","Facets.rsq","RRPT.p","Big5.p","Facets.p")
return(r.df)
}
df.rsq <- f.get.rsq.and.p(RRPT.reg.out,big5.reg.out,facets.reg.out)
write.xlsx(df.rsq, file="Section 3 reg.xlsx", sheetName="Rsq values",append=TRUE)
rm(l,big5.reg.out,facets.reg.out,RRPT.reg.out,df.rsq)
RRPT.reg.out <- f.do.reg(d.crit = d.section.2, d.pred = d.RRPT)
write.xlsx(RRPT.reg.out, file="Section 2 reg.xlsx", sheetName="RRPT", row.names=TRUE, append=TRUE, showNA=FALSE)
#### Big 5
big5.reg.out <- f.do.reg(d.crit = d.section.2, d.pred = d.big5.only)
write.xlsx(big5.reg.out, file="Section 2 reg.xlsx", sheetName="big5", row.names=TRUE, append=TRUE, showNA=FALSE)
facets.reg.out <- f.do.reg(d.crit = d.section.2, d.pred = d.facet.only)
write.xlsx(facets.reg.out, file="Section 2 reg.xlsx", sheetName="facets", row.names=TRUE, append=TRUE, showNA=FALSE)
df.rsq <- f.get.rsq.and.p(RRPT.reg.out,big5.reg.out,facets.reg.out)
write.xlsx(df.rsq, file="Section 2 reg.xlsx", sheetName="Rsq values",append=TRUE)
rm(big5.reg.out,facets.reg.out,RRPT.reg.out,df.rsq)
df.rsq <- f.get.rsq.and.p(RRPT.reg.out,big5.reg.out,facets.reg.out)
RRPT.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.RRPT)
big5.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.big5.only)
facets.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.facet.only)
df.rsq <- f.get.rsq.and.p(RRPT.reg.out,big5.reg.out,facets.reg.out)
df.rsq
df.rsq2 <- df.rsq
ifelse(df.rsq2[,4]<.05,df.rsq2[,1]=df.rsq2[,1],df.rsq2[,1]=0)
ifelse(df.rsq2[,4]<.05,df.rsq2[,1],0)
rm(df.rsq2)
df.rsq2 < ifelse(df.rsq[,4]<.05,df.rsq[,1],0)
df.rsq2 < ifelse(df.rsq[,4]<.05,df.rsq[,1],0)
df.rsq2 <- ifelse(df.rsq[,4]<.05,df.rsq[,1],0)
rm(big5.reg.out,facets.reg.out,RRPT.reg.out,df.rsq)
RRPT.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.RRPT)
write.xlsx(RRPT.reg.out, file="Section 3 reg.xlsx", sheetName="RRPT", row.names=TRUE, append=TRUE, showNA=FALSE)
#### Big 5
big5.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.big5.only)
write.xlsx(big5.reg.out, file="Section 3 reg.xlsx", sheetName="big5", row.names=TRUE, append=TRUE, showNA=FALSE)
#### facets
facets.reg.out <- f.do.reg(d.crit = d.section.3, d.pred = d.facet.only)
write.xlsx(facets.reg.out, file="Section 3 reg.xlsx", sheetName="facets", row.names=TRUE, append=TRUE, showNA=FALSE)
f.get.rsq.and.p <- function(out1,out2,out3){
df.rsq <- data.frame(matrix(ncol = 3, nrow = length(out1)))
df.rsq2 <- data.frame(matrix(ncol = 3, nrow = length(out1)))
df.pvals <- data.frame(matrix(ncol = 3, nrow = length(out1)))
for(l in 1:length(out1)){
crit.var <- names(out1)[l]
df.rsq[l,1] <- out1[[l]][nrow(out1[[l]])-1,1] #get element in column 1, row before last
df.pvals[l,1] <- out1[[l]][nrow(out1[[l]])-2,1] #get element in column 1, two rows before last
df.rsq2[l,1] <- ifelse(df.pvals[l,1]<.05,df.rsq[l,1],0)
df.rsq[l,2] <- out2[[l]][nrow(out2[[l]])-1,1] #get element in column 1, row before last
df.pvals[l,2] <- out2[[l]][nrow(out2[[l]])-2,1] #get element in column 1, row before last
df.rsq2[l,2] <- ifelse(df.pvals[l,2]<.05,df.rsq[l,2],0)
df.rsq[l,3] <- out3[[l]][nrow(out3[[l]])-1,1]
df.pvals[l,3] <- out3[[l]][nrow(out3[[l]])-2,1]
df.rsq2[l,3] <- ifelse(df.pvals[l,3]<.05,df.rsq[l,3],0)
}
r.df <- cbind(df.rsq,df.pvals,df.rsq2)
rownames(r.df) <- names(out1)
colnames(r.df) <- c("RRPT.rsq","Big5.rsq","Facets.rsq","RRPT.p","Big5.p","Facets.p",
"RRPT.rsq","Big5.rsq","Facets.rsq")
return(r.df)
}
df.rsq <- f.get.rsq.and.p(RRPT.reg.out,big5.reg.out,facets.reg.out)
write.xlsx(df.rsq, file="Section 3 reg.xlsx", sheetName="Rsq values",append=TRUE)
rm(big5.reg.out,facets.reg.out,RRPT.reg.out,df.rsq)
RRPT.reg.out <- f.do.reg(d.crit = d.section.2, d.pred = d.RRPT)
write.xlsx(RRPT.reg.out, file="Section 2 reg.xlsx", sheetName="RRPT", row.names=TRUE, append=TRUE, showNA=FALSE)
#### Big 5
big5.reg.out <- f.do.reg(d.crit = d.section.2, d.pred = d.big5.only)
write.xlsx(big5.reg.out, file="Section 2 reg.xlsx", sheetName="big5", row.names=TRUE, append=TRUE, showNA=FALSE)
#### facets
facets.reg.out <- f.do.reg(d.crit = d.section.2, d.pred = d.facet.only)
write.xlsx(facets.reg.out, file="Section 2 reg.xlsx", sheetName="facets", row.names=TRUE, append=TRUE, showNA=FALSE)
df.rsq <- f.get.rsq.and.p(RRPT.reg.out,big5.reg.out,facets.reg.out)
write.xlsx(df.rsq, file="Section 2 reg.xlsx", sheetName="Rsq values",append=TRUE)
rm(big5.reg.out,facets.reg.out,RRPT.reg.out,df.rsq)
facets.reg.out <- f.do.reg(d.crit = d.section.2, d.pred = d.facet.only)
facets.reg.out[[1]]
?f.get.reg.output
?lm
the.pred <- paste(colnames(d.facet.only), collapse='+')
temp = lm(d.section.3$S3_09_Superiors~the.pred)
crit.var.name <- "S3_09_Superiors"
f.p1 <- paste0(crit.var.name, ' ~ ')
f.nameme <- as.formula(paste(f.p1, paste(colnames(d.facet.only), collapse='+')))
d.reg <- cbind(d.facet.only,d.section.3[crit.var.name])
reg <- lm(f.nameme, d.reg)
reg
summary(reg)
f.get.reg.output(reg)
?lm
library('devtools')
library('roxygen2')
remove.packages('psymetlab')
setwd('H:/Google Drive/Git/psymetlab')
document()
check()
setwd('H:/Google Drive/Git/psymetlab')
document()
check()
setwd('H:/Google Drive/Git/psymetlab')
document()
check()
setwd('H:/Google Drive/Git/psymetlab')
document()
check()
remove.packages('psymetlab') # refresh psymetlab
